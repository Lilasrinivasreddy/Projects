

==================================================
select cast(ACTIVITY_DT as date) as profile_date,
       'NEW_ACCOUNTS_MULTI_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PHONE_GRP_TYPE = 'Multi Phone' THEN TOTAL_NEW_ACCTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DAILY_ACCT_ACTIVITY_V2_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NEW_ACCOUNTS_SINGLE_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PHONE_GRP_TYPE = 'Single Phone' THEN TOTAL_NEW_ACCTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DAILY_ACCT_ACTIVITY_V2_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'UNLIMITED_NEW_ACCOUNTS,' as feature_name,
       null as dimension,
       SUM(CASE WHEN (ACCT_PPLAN_TIER2 LIKE '%UNLIMITED%' OR
                     ACCT_PPLAN_TIER2 LIKE '%PURE%' OR
                     ACCT_PPLAN_TIER2 LIKE '%MIX & MATCH%' OR
                     ACCT_PPLAN_TIER2 LIKE '%MYPLANS MIXED PREMIUM%') 
                AND ACCT_STATUS = '30 DAY DEACT' THEN CHG_ACCT_FRACTION * -1
                WHEN (ACCT_PPLAN_TIER2 LIKE '%UNLIMITED%' OR
                      ACCT_PPLAN_TIER2 LIKE '%PURE%' OR
                      ACCT_PPLAN_TIER2 LIKE '%MIX & MATCH%' OR
                      ACCT_PPLAN_TIER2 LIKE '%MYPLANS MIXED PREMIUM%') 
                AND ACCT_STATUS = 'TRUE NEW' THEN CHG_ACCT_FRACTION
                ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DAILY_ACCT_ACTIVITY_V2_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;


select cast(ACTIVITY_DT as date) as profile_date,
       'NET_ACCOUNTS_INCL_SPLITS_MERGES,' as feature_name,
       null as dimension,
       SUM(CASE WHEN acct_status = '30 day deact' THEN chg_acct_fraction * -1
                WHEN acct_status = 'true new' THEN chg_acct_fraction
                WHEN acct_status = 'lost' THEN chg_acct_fraction * -1
                WHEN acct_status = 'react' THEN chg_acct_fraction
                WHEN acct_status = 'merged' THEN chg_acct_fraction * -1
                WHEN acct_status = 'new by split' THEN chg_acct_fraction
                ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DAILY_ACCT_ACTIVITY_V2_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NEW_ACCOUNTS,' as feature_name,
       null as dimension,
       SUM(CASE WHEN acct_status = '30 day deact' THEN chg_acct_fraction * -1 
                WHEN acct_status = 'true new' THEN chg_acct_fraction 
                ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DAILY_ACCT_ACTIVITY_V2_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'TF_SL_NET_ADDS' as feature_name,
       null as dimension,
       SUM(CASE WHEN BRAND = 'SAFELINK' AND ACTIVITY_TYPE = 'Actual_GA' THEN PHONE_CNT + TABLET_CNT + OTHER_CNT
                WHEN BRAND = 'SAFELINK' AND ACTIVITY_TYPE = 'Actual_disconn' THEN (PHONE_CNT + TABLET_CNT + OTHER_CNT) * -1 
                ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.TF_RPT_ACT_DISC_GA_TOTAL_BRAND_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'TF_SL_NET_DEACTS' as feature_name,
       null as dimension,
       SUM(CASE WHEN BRAND = 'SAFELINK' AND ACTIVITY_TYPE = 'Actual_disconn' THEN (PHONE_CNT + TABLET_CNT + OTHER_CNT) ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.TF_RPT_ACT_DISC_GA_TOTAL_BRAND_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'TF_SL_GROSS_ADDS' as feature_name,
       null as dimension,
       SUM(CASE WHEN BRAND = 'SAFELINK' AND ACTIVITY_TYPE = 'Actual_GA' THEN PHONE_CNT + TABLET_CNT + OTHER_CNT ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.TF_RPT_ACT_DISC_GA_TOTAL_BRAND_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'postpaid_two' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') AND CARRIER = 'Other' THEN 1 ELSE 0 END) / 
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') AND CARRIER = 'Other' THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;


select cast(ACTIVITY_DT as date) as profile_date,
       'postpaid_two' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') AND CARRIER = 'TMO' THEN 1 ELSE 0 END) / 
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') AND CARRIER = 'TMO' THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'postpaid_two' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') AND CARRIER = 'TMO' THEN 1 ELSE 0 END) / 
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') AND CARRIER = 'TMO' THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'postpaid_two' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') AND CARRIER = 'ATT' THEN 1 ELSE 0 END) / 
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') AND CARRIER = 'ATT' THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;


select cast(ACTIVITY_DT as date) as profile_date,
       'postpaid_one' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') THEN 1 ELSE 0 END) / 
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_OUT_OTHER_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN (COE_CARRIER IS NULL OR COE_CARRIER = 'Other') AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;


select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_OUT_TMOBILE_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN COE_CARRIER = 'Other' AND SUB_CARRIER_CD = 'COMCAST' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'PORTS_OUT_CHARTER_PHONE,' as feature_name,
       null as dimension,
       'No Longer in One Ex Summary Table' as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from No_Longer_in_One_Ex_Summary_Table
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'PORTS_OUT_COMCAST_PHONE,' as feature_name,
       null as dimension,
       'No Longer in One Ex Summary Table' as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from No_Longer_in_One_Ex_Summary_Table
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_OUT_SPRINT_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN COE_CARRIER = 'Sprint' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_OUT_ATT_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN COE_CARRIER = 'ATT' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PO', 'IO') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;


select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_IN_OTHER_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN (COE_CARRIER IS NULL OR COE_CARRIER = 'Other') AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_IN_TMOBILE_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN COE_CARRIER = 'T-Mobile w_Metro-PCS' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_IN_SPRINT_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN COE_CARRIER = 'Sprint' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'PORTS_IN_COMCAST_PHONE,' as feature_name,
       null as dimension,
       'No Longer in One Ex Summary Table' as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from No_Longer_in_One_Ex_Summary_Table
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'PORTS_IN_CHARTER_PHONE,' as feature_name,
       null as dimension,
       'No Longer in One Ex Summary Table' as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from No_Longer_in_One_Ex_Summary_Table
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(TRANS_DT as date) as profile_date,
       'VZP_MIX_NUM,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PROD_TYPE IN ('VZP','VZP-MD') THEN TMPVZP_TOT_PURE_ACT_value ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(TRANS_DT AS date)) AS weekday
from NTL_PRD_QMVM.VZBI_VZP_MIX_PEAK_RPT_V
where cast(TRANS_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(TRANS_DT as date) as profile_date,
       'VMP_NUM,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PROD_TYPE IN ('VMP','VMP-MD') THEN TMPVZP_TOT_PURE_ACT_value ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(TRANS_DT AS date)) AS weekday
from NTL_PRD_QMVM.VZBI_VZP_MIX_PEAK_RPT_V
where cast(TRANS_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(LAST_UPD_DT as date) as profile_date,
       'PORTS_IN_ATT_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN COE_CARRIER = 'ATT' AND DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') AND ACTIVITY_CD IN ('PI', 'WB') THEN 1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(LAST_UPD_DT AS date)) AS weekday
from NTL_PRD_ALLVM.PORT_SUM_FACT_V
where cast(LAST_UPD_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'PREPAY_WEIGHTED_AVG_DEN,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'Y' AND COE_PPLAN_CTGRY_DESC IN ('Prepaid Smartphone','Prepaid Smartphone Unlimited') AND PPLAN_CD <> 'UNTG' THEN GROSS_ADDS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(TRANS_DT as date) as profile_date,
       'VZPH,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PROD_OFF_PRODUCT_CD IN ('PR.0522') AND coalesce(EIS_INC_IND, 'Y') = 'Y' THEN PROD_BUNDLED_ACT_CNT ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(TRANS_DT AS date)) AS weekday
from NTL_PRD_ALLVM.BI_PROD_ACTIVITY_V
where cast(TRANS_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(TRANS_DT as date) as profile_date,
       'VZP_MIX_DEN,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PROD_TYPE IN ('VZP','TMP','TMP-MD','VZP-MD') THEN TMPVZP_TOT_PURE_ACT_value ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(TRANS_DT AS date)) AS weekday
from NTL_PRD_QMVM.VZBI_VZP_MIX_PEAK_RPT_V
where cast(TRANS_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(UPDATE_DT as date) as profile_date,
       'ARD_NUM,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PYMNT_DT < '2018-01-01' THEN 
                  CASE WHEN SLS_DIST_CHNL_GRP_CD = 'D' AND EQP_CLASS_DESC = 'ACCESSORIES' AND EQP_CTGRY_DESC <> 'SMARTWATCH ACCESSORY' 
                       THEN CAST((ABS(item_price_amt) * NET_SALES) - GROSS_DISCOUNT AS NUMERIC(18,2)) ELSE 0 END 
                ELSE 
                  CASE WHEN SLS_DIST_CHNL_GRP_CD = 'D' AND EQP_CLASS_DESC = 'ACCESSORIES' 
                       THEN CAST((ABS(item_price_amt) * NET_SALES) - GROSS_DISCOUNT AS NUMERIC(18,2)) ELSE 0 END END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(UPDATE_DT AS date)) AS weekday
from NTL_PRD_ALLVM.EQUIP_SUM_FACT_V
where cast(UPDATE_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(UPDATE_DT as date) as profile_date,
       'ARD_DEN,' as feature_name,
       null as dimension,
       SUM(CASE WHEN SLS_DIST_CHNL_GRP_CD = 'D' AND FIN_TOT_FLAG = 'Y' THEN 
                  CASE WHEN DATA_TIER_FIN IN ('SMARTPHONE') OR DEVICE_GROUPING IN ('TABLET','NETBOOK') THEN NET_SALES ELSE 0 END ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(UPDATE_DT AS date)) AS weekday
from NTL_PRD_ALLVM.EQUIP_SUM_FACT_V
where cast(UPDATE_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'PREPAY_WEIGHTED_AVG_NUM,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'Y' AND COE_PPLAN_CTGRY_DESC IN ('Prepaid Smartphone','Prepaid Smartphone Unlimited') THEN (GROSS_ADDS * ACCESS_AMT) ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'TF_NET_DEACTS_TOTAL,' as feature_name,
       null as dimension,
       SUM(CASE WHEN ACTIVITY_TYPE = 'Actual_disconn' THEN (PHONE_CNT + TABLET_CNT + OTHER_CNT) ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_OTHER_WEARABLES,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('Internet') AND DM_DEVICE_GROUPING = 'Wearable Devices' AND MFG_NM <> 'apple' THEN VOLUNTARY_DISCONNECTS + INVOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'MRC_STEP_RATIO_NUM,' as feature_name,
       null as dimension,
       SUM(CASE WHEN ACCT_STATUS = 'EXISTING' AND ACCT_PPLAN_CHG_IND = 'Y' AND curr_prev_ind = 'c' AND tot_acct_lvl_rev_change = 'increase' THEN chg_acct_fraction ELSE 0.00000000 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'MRC_STEP_RATIO_DEN,' as feature_name,
       null as dimension,
       SUM(CASE WHEN ACCT_STATUS = 'EXISTING' AND ACCT_PPLAN_CHG_IND = 'Y' AND curr_prev_ind = 'c' AND tot_acct_lvl_rev_change = 'decrease' THEN chg_acct_fraction ELSE 0.00000000 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_OTHER,' as feature_name,
       null as dimension,
       SUM(INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS) - SUM(CASE WHEN DM_DATA_TIER_FIN IN ('BASIC','SMARTPHONE') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) - SUM(CASE WHEN DM_DEVICE_GROUPING IN ('TABLET') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) - SUM(CASE WHEN PROD_NM IN ('HUM BY VERIZON','HUM EXTREME','VERIZON HUM X','VERIZON HUM X - TEST','VERIZON TELEMATICS - AT-150','HUM PLUS VT410','HUM PLUS VT410 DTC','HUMX VT1010') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) - SUM(CASE WHEN DM_DATA_TIER_FIN IN ('Internet') AND DM_DEVICE_GROUPING = 'Wearable Devices' AND MFG_NM = 'apple' THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) - SUM(CASE WHEN PREPAID_IND = 'N' AND FWA_TECH_TYPE_PPLAN IN ('5G C-Band','4G LTE','5G mmWave') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) - SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('Internet') AND DM_DEVICE_GROUPING = 'Wearable Devices' AND MFG_NM <> 'apple' THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(INSERT_DT as date) as profile_date,
       'VSB_NET_DEACTS,' as feature_name,
       null as dimension,
       SUM(CASE WHEN REV_GEN_IND = 'TRUE' AND MANAGED_IND <> 'U' AND ACTIVITY_CD = 'DE' THEN 1 WHEN REV_GEN_IND = 'TRUE' AND MANAGED_IND <> 'U' AND ACTIVITY_CD = 'RE' THEN -1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(INSERT_DT AS date)) AS weekday
from NTL_PRD_ALLVM.VL_DAILY_LINE_ACTIVITY_V
where cast(INSERT_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_TOTAL_FWA,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND COE_PPLAN_CTGRY_DESC IN ('Fixed Wireless') THEN VOLUNTARY_DISCONNECTS + INVOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'B2B_M2M_NET_DEACTS_TOTAL_FWA,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND REV_GEN_IND = 'Y' AND LINE_TYPE_CD = 'T' AND COE_SEGMT_CTGRY_COMMON = 'BUSINESS' AND COE_PPLAN_CTGRY_DESC IN ('Fixed Wireless') THEN (INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS)*-1 ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_APPLE_SMARTWATCH,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DM_DATA_TIER_FIN IN ('Internet') AND DM_DEVICE_GROUPING = 'Wearable Devices' AND MFG_NM = 'apple' THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;
