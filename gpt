def initialize_metadata_records(self):
    """
    Inserts all metadata records into dqaas_ran_rule_ctrl_tbl where active_flag='Y'.
    Initializes run_status as 'NS' (Not Started) and profile_date as NULL.
    """
    try:
        query = f"""
        INSERT INTO `{config.dq_project_id}.{config.dq_bq_dataset}.dqaas_ran_rule_ctrl_tbl` 
        (profile_id, table_name, run_ts, run_status, profile_date, comments)
        SELECT profile_id, table_name, timestamp('{datetime.now().strftime("%Y-%m-%d %H:%M:%S")}'), 
               'NS', NULL, ''
        FROM `{config.dq_project_id}.{config.dq_bq_dataset}.dqaas_metadata_table`
        WHERE active_flag = 'Y'
        """

        self.logger.info("Initializing metadata records in dqaas_ran_rule_ctrl_tbl...")
        self.run_bq_sql(bq_auth=config.dq_gcp_auth_payload, select_query=query)
        self.logger.info("Metadata records inserted successfully for today's run.")

    except Exception as e:
        self.logger.error(f"Error inserting metadata records: {str(e)}")




def update_metadata_records(self, profile_id, table_name, run_status, run_ts, profile_date, comments):
    """
    Updates the dqaas_ran_rule_ctrl_tbl table after execution.
    """
    try:
        update_query = f"""
        UPDATE `{config.dq_project_id}.{config.dq_bq_dataset}.dqaas_ran_rule_ctrl_tbl`
        SET run_status = '{run_status}',
            run_ts = timestamp('{run_ts}'),
            profile_date = DATE('{profile_date}'),
            comments = '{comments}'
        WHERE profile_id = {profile_id} AND table_name = '{table_name}'
        """

        self.logger.info(f"Updating run status for Profile ID: {profile_id}, Table: {table_name}")
        self.run_bq_sql(bq_auth=config.dq_gcp_auth_payload, select_query=update_query)
        self.logger.info(f"Successfully updated metadata for Profile ID: {profile_id}, Table: {table_name}")

    except Exception as e:
        self.logger.error(f"Error updating metadata records: {str(e)}")
