if __name__ == "__main__":
    # Step 1: Filter out rows where status is 'ignore'
    questions = questions[questions['Status'].str.strip().str.lower() != 'ignore']

    # Step 2: Drop rows where question or expected_query is missing
    questions.dropna(subset=['question', 'expected_query'], inplace=True)

    # Step 3: Call converse API to get generated queries and history IDs
    df_with_generated = converse_and_extract(questions)

    # Step 4: Call catalog rules API to get rule differences
    final_df = get_catalog_rules(df_with_generated)

    # Step 5: Save results to CSV
    output_filename = f"qverse_validation_output_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv"
    final_df.to_csv(output_filename, index=False)
    print(f"\nâœ… Results saved to file: {output_filename}")
