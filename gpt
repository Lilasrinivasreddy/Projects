select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_TOTAL,' as feature_name,
       null as dimension,
       SUM(INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_PHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DATA_TIER IN ('BASIC','SMARTPHONE') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_SMARTPHONE,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DATA_TIER IN ('SMARTPHONE') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS 
                WHEN PREPAID_IND <> 'N' AND COE_PPLAN_CTGRY_DESC IN ('Prepaid Smartphone','Prepaid Smartphone Unlimited') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_TABLET,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND DEVICE_GROUPING IN ('TABLET') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;

select cast(ACTIVITY_DT as date) as profile_date,
       'NET_DEACTS_HUM,' as feature_name,
       null as dimension,
       SUM(CASE WHEN PREPAID_IND = 'N' AND PROD_NM IN ('HUM BY VERIZON','HUM EXTREME','VERIZON HUM X','VERIZON HUM X - TEST','VERIZON TELEMATICS - AT-150','HUM PLUS VT410','HUM PLUS VT410 DTC','HUMX VT1010') THEN INVOLUNTARY_DISCONNECTS + VOLUNTARY_DISCONNECTS ELSE 0 END) as "value",
       current_timestamp as insert_date,
       dayofweek(cast(ACTIVITY_DT AS date)) AS weekday
from NTL_PRD_ALLVM.DLA_SUM_FACT_V
where cast(ACTIVITY_DT as date) = current_date - 1
group by 1,2,3,5,6;
