INSERT INTO "vz-it-np-izcv-dev-idmcdo-0"."dga_dq_tbls"."dqaas_profile_rpt"
(
    rpt_seq_num, prfl_id, prfl_type, dq_pillar, src_tbl, meas_name,
    data_dt, feature_name, grouped_columns, count_curr, prfl_run_ts, weekday
)
SELECT
    CAST(900098 AS INTEGER) AS rpt_seq_num,
    CAST(7851 AS INTEGER) AS prfl_id,
    'CUSTOM_RULES' AS prfl_type,
    'Consistency' AS dq_pillar,
    'CUST_ACCT_LINE_ADDR_V' AS src_tbl,
    'CUST_ACCT_LINE_ADDR_V Table count' AS meas_name,
    CAST(LAST_UPD_DT AS DATE) AS data_dt,
    'Tier1 Models' AS feature_name,
    NULL AS grouped_columns,
    COUNT(*) AS count_curr,
    CURRENT_TIMESTAMP AS prfl_run_ts,
    DAYOFWEEK(CAST(LAST_UPD_DT AS DATE)) AS weekday
FROM "NTL_PRD_ALLVM"."CUST_ACCT_LINE_ADDR_V"
WHERE CAST(LAST_UPD_DT AS DATE) >= CURRENT_DATE - 90
GROUP BY
    CAST(LAST_UPD_DT AS DATE),
    DAYOFWEEK(CAST(LAST_UPD_DT AS DATE));


def fix_query_format(query):
    """
    Fixes schema, table, and column names formatting.
    Ensures double quotes only wrap schema and table names.
    """
    print(f"üîç Original Query Before Fixing:\n{query}\n")

    # ‚úÖ Ensure schema and table names are correctly formatted
    fixed_query = query.replace('""', '"')  # Remove extra quotes
    fixed_query = re.sub(r'(["\'])(\w+-\w+-\w+-\w+-\w+)(["\'])', r'"\2"', fixed_query)  # Fix schema names
    fixed_query = re.sub(r'(["\'])(\w+\.\w+)(["\'])', r'"\2"', fixed_query)  # Fix table names
    fixed_query = re.sub(r'(["\'])(\w+\s\w+)(["\'])', r"'\2'", fixed_query)  # Fix column values

    print(f"‚úÖ Fixed Query:\n{fixed_query}\n")
    return fixed_query
