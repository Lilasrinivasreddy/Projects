2025-04-07 09:20:17 : CRM-652444 - profile_engine - INFO : Index:: 54, Rule ID:: 8050
2025-04-07 09:20:17 : CRM-652444 - run_bq_sql - INFO :
BQ Select Query: select cast(event_date as date)as profile_date,
'Tier1 Models' as feature_name,
null as dimension,
count (*) as value,
current_timestamp as insert_date,
extract(dayofweek from event_date) as weekday
from vz-it-pr-gk1v-cwlsdo-0.vzw_uda_prd_tbls_rd_v.scm_usage where cast(event_date as date)>= current_date -2 group by 1,2,3,5,6
2025-04-07 09:20:17 : CRM-652444 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-04-07 09:20:17 : CRM-652444 - isTokenExpired - INFO : Token File Available
2025-04-07 09:20:17 : CRM-652444 - isTokenExpired - INFO : Access Token is Valid
2025-04-07 09:20:17 : CRM-652444 - bigquery_client - INFO : Setting environment variable...
2025-04-07 09:20:17 : CRM-652444 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-04-07 09:20:21 : CRM-652444 - profile_engine - INFO :
      data_dt  feature_name  dimension  count_curr                      insert_date  weekday  prfl_id
0  2445-03-08  Tier1 Models       <NA>           2 2025-04-07 13:20:18.178355+00:00        4     8050
1  3116-03-01  Tier1 Models       <NA>           1 2025-04-07 13:20:18.178355+00:00        4     8050
2  4017-08-08  Tier1 Models       <NA>           1 2025-04-07 13:20:18.178355+00:00        3     8050
3  4016-04-08  Tier1 Models       <NA>           1 2025-04-07 13:20:18.178355+00:00        6     8050
4  4000-04-24  Tier1 Models       <NA>           2 2025-04-07 13:20:18.178355+00:00        2     8050
5  2025-04-05  Tier1 Models       <NA>      327280 2025-04-07 13:20:18.178355+00:00        7     8050
6  2025-04-06  Tier1 Models       <NA>      484746 2025-04-07 13:20:18.178355+00:00        1     8050
2025-04-07 09:20:21 : CRM-652444 - profile_engine - INFO : ------------------------------------------------------------------
2025-04-07 09:20:21 : CRM-652444 - profile_engine - INFO : ------------------------------------------------------------------
2025-04-07 09:20:21 : CRM-652444 - profile_engine - INFO : Index:: 55, Rule ID:: 8051
2025-04-07 09:20:21 : CRM-652444 - run_bq_sql - INFO :
BQ Select Query: select cast(LAST_UPD_DT as date)as profile_date,
'Tier1 Models' as feature_name,
null as dimension,
count (*) as value,
current_timestamp as insert_date,
extract(dayofweek from LAST_UPD_DT) as weekday
from vz-it-pr-gk1v-cwlsdo-0.vzw_uda_prd_tbls_rd_v.service where cast(LAST_UPD_DT as date)>= current_date -2 group by 1,2,3,5,6
2025-04-07 09:20:21 : CRM-652444 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-04-07 09:20:21 : CRM-652444 - isTokenExpired - INFO : Token File Available
2025-04-07 09:20:21 : CRM-652444 - isTokenExpired - INFO : Access Token is Valid
2025-04-07 09:20:21 : CRM-652444 - bigquery_client - INFO : Setting environment variable...
2025-04-07 09:20:21 : CRM-652444 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-04-07 09:20:25 : CRM-652444 - profile_engine - INFO :
      data_dt  feature_name  dimension  count_curr                      insert_date  weekday  prfl_id
0  2025-04-06  Tier1 Models       <NA>       24112 2025-04-07 13:20:22.505660+00:00        1     8051
2025-04-07 09:20:25 : CRM-652444 - profile_engine - INFO : ------------------------------------------------------------------
2025-04-07 09:20:25 : CRM-652444 - profile_engine - INFO : Length of the Rules Result : 148
2025-04-07 09:20:25 : CRM-652444 - profile_engine - INFO :
Index(['data_dt', 'feature_name', 'dimension', 'count_curr', 'rule_run_ts',
       'weekday', 'prfl_id', 'insert_date'],
      dtype='object')
      data_dt  feature_name  dimension  count_curr                rule_run_ts  weekday  prfl_id                      insert_date
0  2025-04-06  Tier1 Models        NaN           0 2025-04-07 09:12:59.550843        1     7992                              NaT
1  2025-04-05  Tier1 Models        NaN      326978                        NaT        7     7993 2025-04-07 13:13:00.250319+00:00
2  2025-04-07  Tier1 models        NaN         872                        NaT        2     7994 2025-04-07 13:13:04.741913+00:00
3  2025-03-22  Tier1 Models        NaN   535979192                        NaT        7     7995 2025-04-07 13:13:08.862459+00:00
4  2025-03-29  Tier1 Models        NaN   536075831                        NaT        7     7995 2025-04-07 13:13:08.862459+00:00
2025-04-07 09:20:25 : CRM-652444 - run_bq_sql - INFO :
BQ Select Query:
            with top_records as
            (
            select *,row_number() over (partition by prfl_id,feature_name,grouped_columns order by data_dt desc) as row_num
            from vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt join
            unnest(GENERATE_DATE_ARRAY(date_sub(current_date-1,INTERVAL 3 MONTH),current_date-1, INTERVAL 1 day)) as interval_Date
            on data_dt = interval_Date
            where prfl_id IN (7992, 7993, 7994, 7995, 7996, 7997, 7998, 7999, 8000, 8001, 8002, 8003, 8004, 8005, 8006, 8007, 8008, 8009, 8010, 8011, 8012, 8013, 8014, 8015, 8016, 8017, 8018, 8019, 8020, 8021, 8022, 8023, 8024, 8025, 8026, 8027, 8028, 8029, 8030, 8031, 8032, 8034, 8038, 8039, 8040, 8041, 8042, 8043, 8044, 8045, 8046, 8047, 8048, 8049, 8050, 8051)
            and data_dt != current_date-1
            order by prfl_id,feature_name, grouped_columns,data_dt desc
            )
            select prfl_id,feature_name,grouped_columns,WEEKDAY,
            round(sum(ifnull(count_curr, 0)), 2) as sum_count_prev,
            round(avg(ifnull(count_curr, 0)), 2) as avg_count_prev,
            round(var_pop(ifnull(count_curr, 0)), 2) as variance_value,
            round(stddev_pop(ifnull(count_curr, 0)), 2) as std_dev_value,
            round(stddev_pop(ifnull(count_curr, 0)) * 2.0, 2) as sigma_2_value,
            round(avg(ifnull(count_curr, 0)) - stddev_pop(ifnull(count_curr, 0)) * 2.0, 2) as min_thresh_value,
            round(avg(ifnull(count_curr, 0)) + stddev_pop(ifnull(count_curr, 0)) * 2.0, 2) as max_thresh_value
            from top_records
            group by prfl_id,feature_name,grouped_columns,WEEKDAY
            order by prfl_id,feature_name,grouped_columns,WEEKDAY;

2025-04-07 09:20:25 : CRM-652444 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-04-07 09:20:25 : CRM-652444 - isTokenExpired - INFO : Token File Available
2025-04-07 09:20:25 : CRM-652444 - isTokenExpired - INFO : Access Token is Valid
2025-04-07 09:20:25 : CRM-652444 - bigquery_client - INFO : Setting environment variable...
2025-04-07 09:20:25 : CRM-652444 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-04-07 09:20:28 : CRM-652444 - get_historical_details - INFO : Length of the historical groupby list : 332
2025-04-07 09:20:28 : CRM-652444 - get_historical_details - INFO :
Index(['prfl_id', 'feature_name', 'grouped_columns', 'weekday',
       'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value',
       'sigma_2_value', 'min_thresh_value', 'max_thresh_value'],
      dtype='object')
   prfl_id  feature_name grouped_columns  weekday  ... std_dev_value sigma_2_value  min_thresh_value  max_thresh_value
0     7992  Tier1 Models                        2  ...          0.00          0.00              0.00              0.00
1     7992  Tier1 Models                        3  ...          0.00          0.00              0.00              0.00
2     7992  Tier1 Models                        4  ...          0.00          0.00              0.00              0.00
3     7992  Tier1 Models                        5  ...          0.00          0.00              0.00              0.00
4     7993  Tier1 Models            None        2  ...          0.91          1.82         533059.77         533063.41

[5 rows x 11 columns]
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO : ------------------------------------------------------------------
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO : Length of the historical Records : 332
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO :
Index(['prfl_id', 'feature_name', 'grouped_columns', 'weekday',
       'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value',
       'sigma_2_value', 'min_thresh_value', 'max_thresh_value'],
      dtype='object')
   prfl_id  feature_name grouped_columns  weekday  ... std_dev_value sigma_2_value  min_thresh_value  max_thresh_value
0     7992  Tier1 Models                        2  ...          0.00          0.00              0.00              0.00
1     7992  Tier1 Models                        3  ...          0.00          0.00              0.00              0.00
2     7992  Tier1 Models                        4  ...          0.00          0.00              0.00              0.00
3     7992  Tier1 Models                        5  ...          0.00          0.00              0.00              0.00
4     7993  Tier1 Models             NaN        2  ...          0.91          1.82         533059.77         533063.41

[5 rows x 11 columns]
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO : ------------------------------------------------------------------
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO : Length of the latest Records : 148
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO :
Index(['data_dt', 'feature_name', 'grouped_columns', 'count_curr',
       'prfl_run_ts', 'weekday', 'prfl_id', 'insert_date'],
      dtype='object')
      data_dt  feature_name  grouped_columns  count_curr          prfl_run_ts  weekday  prfl_id                      insert_date
0  2025-04-06  Tier1 Models              NaN           0  2025-04-07 09:20:25        1     7992                              NaT
1  2025-04-05  Tier1 Models              NaN      326978  2025-04-07 09:20:25        7     7993 2025-04-07 13:13:00.250319+00:00
2  2025-04-07  Tier1 models              NaN         872  2025-04-07 09:20:25        2     7994 2025-04-07 13:13:04.741913+00:00
3  2025-03-22  Tier1 Models              NaN   535979192  2025-04-07 09:20:25        7     7995 2025-04-07 13:13:08.862459+00:00
4  2025-03-29  Tier1 Models              NaN   536075831  2025-04-07 09:20:25        7     7995 2025-04-07 13:13:08.862459+00:00
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO : ------------------------------------------------------------------
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO : Historical Dataframe ::      prfl_id  feature_name grouped_columns  weekday  ... std_dev_value sigma_2_value  min_thresh_value  max_thresh_value
0       7992  Tier1 Models                        2  ...          0.00          0.00              0.00              0.00
1       7992  Tier1 Models                        3  ...          0.00          0.00              0.00              0.00
2       7992  Tier1 Models                        4  ...          0.00          0.00              0.00              0.00
3       7992  Tier1 Models                        5  ...          0.00          0.00              0.00              0.00
4       7993  Tier1 Models             NaN        2  ...          0.91          1.82         533059.77         533063.41
..       ...           ...             ...      ...  ...           ...           ...               ...               ...
327     8050  Tier1 Models                        5  ...          0.00          0.00         573454.00         573454.00
328     8051  Tier1 Models                        2  ...          0.00          0.00          24048.00          24048.00
329     8051  Tier1 Models                        3  ...          0.00          0.00          24049.00          24049.00
330     8051  Tier1 Models                        4  ...          0.00          0.00          24061.00          24061.00
331     8051  Tier1 Models                        5  ...          0.00          0.00          24061.00          24061.00

[332 rows x 11 columns]
2025-04-07 09:20:28 : CRM-652444 - compare_historical_latest_dimensions - INFO : Latest Dataframe ::         data_dt  feature_name  grouped_columns  count_curr          prfl_run_ts  weekday  prfl_id                      insert_date
0    2025-04-06  Tier1 Models              NaN           0  2025-04-07 09:20:25        1     7992                              NaT
1    2025-04-05  Tier1 Models              NaN      326978  2025-04-07 09:20:25        7     7993 2025-04-07 13:13:00.250319+00:00
2    2025-04-07  Tier1 models              NaN         872  2025-04-07 09:20:25        2     7994 2025-04-07 13:13:04.741913+00:00
3    2025-03-22  Tier1 Models              NaN   535979192  2025-04-07 09:20:25        7     7995 2025-04-07 13:13:08.862459+00:00
4    2025-03-29  Tier1 Models              NaN   536075831  2025-04-07 09:20:25        7     7995 2025-04-07 13:13:08.862459+00:00
..          ...           ...              ...         ...                  ...      ...      ...                              ...
143  4016-04-08  Tier1 Models              NaN           1  2025-04-07 09:20:25        6     8050 2025-04-07 13:20:18.178355+00:00
144  4000-04-24  Tier1 Models              NaN           2  2025-04-07 09:20:25        2     8050 2025-04-07 13:20:18.178355+00:00
145  2025-04-05  Tier1 Models              NaN      327280  2025-04-07 09:20:25        7     8050 2025-04-07 13:20:18.178355+00:00
146  2025-04-06  Tier1 Models              NaN      484746  2025-04-07 09:20:25        1     8050 2025-04-07 13:20:18.178355+00:00
147  2025-04-06  Tier1 Models              NaN       24112  2025-04-07 09:20:25        1     8051 2025-04-07 13:20:22.505660+00:00

[148 rows x 8 columns]
2025-04-07 09:20:28 : CRM-652444 - run_metrics_engine - ERROR : Error in Run Metrics Main Block. Error You are trying to merge on object and float64 columns. If you wish to proceed you should use pd.concat
2025-04-07 09:20:28 : CRM-652444 - main - ERROR : Error in Main Block. Error object of type 'NoneType' has no len()
