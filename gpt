# Total rows count
total_table_count = len(table_meta_df)

# Frequency validation
table_frequency_validation_cnt = total_table_count - table_meta_df['frequency'].str.lower().isin(frequency_list).sum()

# Platform name validation
table_platform_name_validation_cnt = total_table_count - table_meta_df['platform_name'].str.lower().isin(platform_list).sum()

# Environment name validation
table_env_name_validation_cnt = total_table_count - table_meta_df['environment_name'].str.lower().isin(env_list).sum()

# Threshold validations
low_null_count = table_meta_df['threshold_low'].replace('', pd.NA).isna().sum()
low_numeric_count = table_meta_df['threshold_low'].fillna('').astype(str).apply(lambda x: x.strip().isdigit()).sum()
table_threshold_low_validation_cnt = total_table_count - low_null_count - low_numeric_count

up_null_count = table_meta_df['threshold_up'].replace('', pd.NA).isna().sum()
up_numeric_count = table_meta_df['threshold_up'].fillna('').astype(str).apply(lambda x: x.strip().isdigit()).sum()
table_threshold_up_validation_cnt = total_table_count - up_null_count - up_numeric_count

# Email validation
null_email_count = table_meta_df['table_size_notification_email_list'].isnull().sum()
email_validation_count = total_table_count - table_meta_df.loc[
    table_meta_df['table_size_notification_email_list'].fillna('na').str.contains(r'[^@]+@[^@]+\.[^@]+', case=False), :
].shape[0]
email_validation_count -= null_email_count

# Boolean validation
table_is_active_validation_cnt = total_table_count - table_meta_df['is_active'].fillna('n').str.upper().isin(['Y', 'N']).sum()
table_notify_table_size_validation_cnt = total_table_count - table_meta_df['notify_table_size'].fillna('n').str.upper().isin(['Y', 'N']).sum()

# Mandatory columns validation
mandatory_columns = ['dag_id', 'task_id', 'table_name', 'db_name', 'server_name', 'platform_name', 'environment_name']
missing_mandatory_columns = []
for col in mandatory_columns:
    if table_meta_df[col].isna().any() or (table_meta_df[col].astype(str).str.strip() == "").any():
        missing_mandatory_columns.append(col)

# Raise validation errors if any
if table_frequency_validation_cnt > 0 or table_platform_name_validation_cnt > 0 or \
   table_env_name_validation_cnt > 0 or table_threshold_low_validation_cnt > 0 or \
   table_threshold_up_validation_cnt > 0 or len(missing_mandatory_columns) > 0:
    raise ValueError(
        f"TABLE META VALIDATION FAILED:\n\n"
        f"Frequency validation failed count: {table_frequency_validation_cnt}\n"
        f"Platform name validation failed count: {table_platform_name_validation_cnt}\n"
        f"Environment name validation failed count: {table_env_name_validation_cnt}\n"
        f"Threshold low validation failed count: {table_threshold_low_validation_cnt}\n"
        f"Threshold up validation failed count: {table_threshold_up_validation_cnt}\n"
        f"Email validation failed count: {email_validation_count}\n"
        f"Is_active validation failed count: {table_is_active_validation_cnt}\n"
        f"Missing mandatory columns: {missing_mandatory_columns}"
    )
