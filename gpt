WITH filtered_data AS (
            SELECT t1.src_tbl, t1.tbl_completeness, t1.tbl_timeliness, t1.tbl_uniqueness, t1.tbl_conformity, t1.tbl_validity, t1.tbl_consistency, DATE(t1.auto_prfl_run_dt) AS run_date 
            FROM \`${process.env.DQ_PROJECT_ID}.dga_dq_tbls.dqaas_auto_prfl_tbl_rpt\` AS t1 
            JOIN \`${process.env.DQ_PROJECT_ID}.dga_dq_tbls.dqaas_label_taxonomy_mtd\` AS t2 
            ON t2.table_name = t1.src_tbl 
            WHERE t2.product_name = @productName 
            AND DATE(t1.auto_prfl_run_dt) BETWEEN ${startDate} AND ${endDate}
        ), table_avg AS (
            SELECT src_tbl, AVG(tbl_completeness) AS avg_tbl_completeness, AVG(tbl_timeliness) AS avg_tbl_timeliness, AVG(tbl_uniqueness) AS avg_tbl_uniqueness, AVG(tbl_conformity) AS avg_tbl_conformity, AVG(tbl_validity) AS avg_tbl_validity, AVG(tbl_consistency) AS avg_tbl_consistency 
            FROM filtered_data 
            GROUP BY src_tbl
        ) 
        SELECT AVG(avg_tbl_completeness) AS completeness, AVG(avg_tbl_timeliness) AS timeliness, AVG(avg_tbl_uniqueness) AS uniqueness, AVG(avg_tbl_conformity) AS conformity, AVG(avg_tbl_validity) AS validity, AVG(avg_tbl_consistency) AS consistency 
        FROM table_avg
8:07
Product ID linechart query
SELECT 
            FORMAT_DATE('%Y-%m-%d', DATE(t1.auto_prfl_run_dt)) as run_date,
            AVG(t1.tbl_dq_score) as score
        FROM \`${process.env.DQ_PROJECT_ID}.dga_dq_tbls.dqaas_auto_prfl_tbl_rpt\` t1
        JOIN \`${process.env.DQ_PROJECT_ID}.dga_dq_tbls.dqaas_label_taxonomy_mtd\` t2
        ON t1.src_tbl = t2.table_name
        WHERE t2.product_name = @productName
        AND DATE(t1.auto_prfl_run_dt) BETWEEN ${startDate} AND ${endDate}
        GROUP BY run_date
        ORDER BY run_date
New
8:10
To get the Product name list
SELECT DISTINCT product_name FROM \`${process.env.DQ_PROJECT_ID}.dga_dq_tbls.dqaas_label_taxonomy_mtd\



=====================
dqaas_meta---new mtd table
dqaas_auto_prfl_mtd --- old mtd table






8:04
dqaas_auto_prfl_col_rpt----old column report table
dqaas_column_report --- new column report table
8:05
dqaas_auto_prfl_tbl_rpt----old table report
dqaas_table_report --new
8:06
dqaas_label_taxonomy_mtd --- old taxonomy table
8:06
dqaas_taxonomy_meta ---new






WITH filtered_data AS (
    SELECT 
        t1.src_tbl, 
        t1.tbl_completeness, 
        t1.tbl_timeliness, 
        t1.tbl_uniqueness, 
        t1.tbl_conformity, 
        t1.tbl_validity, 
        t1.tbl_consistency, 
        DATE(t1.auto_prfl_run_dt) AS run_date 
    FROM 
        `${process.env.DQ_PROJECT_ID}.dga_dq_tbls.dqaas_table_report` AS t1 
    JOIN 
        `${process.env.DQ_PROJECT_ID}.dga_dq_tbls.dqaas_label_taxonomy_mtd` AS t2 
    ON 
        t2.table_name = t1.src_tbl 
    WHERE 
        t2.product_name = @productName 
        AND DATE(t1.auto_prfl_run_dt) BETWEEN ${startDate} AND ${endDate}
), 
table_avg AS (
    SELECT 
        src_tbl, 
        AVG(tbl_completeness) AS avg_tbl_completeness, 
        AVG(tbl_timeliness) AS avg_tbl_timeliness, 
        AVG(tbl_uniqueness) AS avg_tbl_uniqueness, 
        AVG(tbl_conformity) AS avg_tbl_conformity, 
        AVG(tbl_validity) AS avg_tbl_validity, 
        AVG(tbl_consistency) AS avg_tbl_consistency 
    FROM 
        filtered_data 
    GROUP BY 
        src_tbl
) 
SELECT 
    AVG(avg_tbl_completeness) AS completeness, 
    AVG(avg_tbl_timeliness) AS timeliness, 
    AVG(avg_tbl_uniqueness) AS uniqueness, 
    AVG(avg_tbl_conformity) AS conformity, 
    AVG(avg_tbl_validity) AS validity, 
    AVG(avg_tbl_consistency) AS consistency 
FROM 
    table_avg




auto_prfl_num
INTEGER	REQUIRED	-	-	-	
-	
-
prfl_tbl_id
INTEGER	REQUIRED	-	-	-	
-	
-
auto_prfl_run_dt
TIMESTAMP	NULLABLE	-	-	CURRENT_TIMESTAMP()	
-	
-
src_tbl
STRING	NULLABLE	-	-	-	
-	
-
tbl_completeness
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_uniqueness
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_timeliness
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_duplicates
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_col_counts
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_row_counts
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_total_cells
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_sample_row_count
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_avg_count
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_variation_perc
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_conformity
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_validity
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_integrity
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_consistency
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_dq_score
NUMERIC	NULLABLE	-	-	-	
-	
-
rpt_ref_key
STRING	NULLABLE	-	-	-





=======================
rpt_ref_key
STRING	NULLABLE	-	-	-	
-	
-
profile_id
INTEGER	NULLABLE	-	-	-	
-	
-
prfl_run_dt
TIMESTAMP	NULLABLE	-	-	current_timestamp	
-	
-
profile_type
STRING	NULLABLE	-	-	-	
-	
-
table_name
STRING	NULLABLE	-	-	-	
-	
-
tbl_completeness
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_uniqueness
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_timeliness
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_duplicates
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_col_counts
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_row_counts
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_total_cells
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_sample_row_count
INTEGER	NULLABLE	-	-	-	
-	
-
tbl_avg_count
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_variation_perc
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_conformity
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_validity
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_integrity
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_consistency
NUMERIC	NULLABLE	-	-	-	
-	
-
tbl_dq_score
NUMERIC	NULLABLE	-	-	-	
-	
-

