select meas_dt,sum(cycle_start_dt_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when REGEXP_CONTAINS(cast(cycle_start_dt as string),"^[0-9]{4}-[0-9]{2}-[0-9]{2}$") or cycle_start_dt is not null then 0 else 1 end cycle_start_dt_pttrn 
    from (
        select cast(cycle_start_dt as date) cycle_start_dt ,cast(report_month as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select cast(report_month as date) as meas_dt, COUNT(*) as meas_value,current_timestamp load_ts 
from vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
where cast(report_month as date) ='2025-03-01' 
group by meas_dt;

select meas_dt,sum(report_month_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when REGEXP_CONTAINS(cast(report_month as string),"^[0-9]{4}-[0-9]{2}-[0-9]{2}$") or report_month is not null then 0 else 1 end report_month_pttrn 
    from (
        select cast(report_month as date) report_month ,cast(report_month as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(last_cycle_dt_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when REGEXP_CONTAINS(cast(last_cycle_dt as string),"^[0-9]{4}-[0-9]{2}-[0-9]{2}$") or last_cycle_dt is not null then 0 else 1 end last_cycle_dt_pttrn 
    from (
        select cast(last_cycle_dt as date) last_cycle_dt ,cast(report_month as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(primary_sector_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when safe_cast(primary_sector as INT64) is not null then 0 else 1 end primary_sector_pttrn 
    from (
        select primary_sector,cast(report_month as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(primary_enodeb_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when cast(primary_enodeb as string) is null or primary_enodeb like "[^0-9]" or length(primary_enodeb) != 6 then 1 else 0 end primary_enodeb_pttrn 
    from (
        select primary_enodeb,cast(report_month as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(minutes_of_usage_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when safe_cast(minutes_of_usage as INT64) is not null then 0 else 1 end minutes_of_usage_pttrn,minutes_of_usage 
    from (
        select minutes_of_usage,cast(process_dt as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(cycle_end_dt_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when REGEXP_CONTAINS(cast(cycle_end_dt as string),"^[0-9]{4}-[0-9]{2}-[0-9]{2}$") or cycle_end_dt is not null then 0 else 1 end cycle_end_dt_pttrn 
    from (
        select cast(cycle_end_dt as date) cycle_end_dt ,cast(report_month as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(cnt) as meas_value,current_timestamp load_ts from (
    select count(distinct concat(coalesce(cast(acct_num as string),""),"|",coalesce(cust_id,""),"|",coalesce(cust_line_seq_id,""))) cnt,cast(report_month as date) meas_dt 
    FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
    where cast(report_month as date) ='2025-03-01' 
    group by acct_num,cust_id,cust_line_seq_id ,cast(report_month as date)
) y group by meas_dt;

select meas_dt,sum(customer_segment_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when cast(customer_segment as string) is not null then 0 else 1 end customer_segment_pttrn 
    from (
        select customer_segment,cast(report_month as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(usage_overage_pttrn) as meas_value,current_timestamp load_ts from (
    select meas_dt,case when safe_cast(usage_overage as FLOAT64) is not null then 0 else 1 end usage_overage_pttrn,usage_overage 
    from (
        select usage_overage,cast(process_dt as date) meas_dt 
        FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_monthly_norm_v0 
        where cast(report_month as date) ='2025-03-01'
    ) t 
) y group by meas_dt;

select meas_dt,sum(cnt) as meas_value,current_timestamp load_ts from (
    select count(distinct concat(coalesce(cast(acct_num as string),""),"|",coalesce(cust_id,""),"|",coalesce(cust_line_seq_id,""))) cnt,cast(report_month as date) meas_dt 
    FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_summary_norm_v0 
    where cast(report_month as date) ='2025-03-01' 
    group by acct_num,cust_id,cust_line_seq_id ,cast(report_month as date)
) y group by meas_dt;

select meas_dt,sum(cnt) as meas_value,current_timestamp load_ts from (
    select count(1) cnt,cast(report_month as date) meas_dt 
    FROM vz-it-pr-gudv-dtwndo-0.aid_dtwin_customer_core_tbls_rd_v.customer_attributes_summary_norm_v0 
    where cast(report_month as date) ='2025-03-01' 
    group by acct_num,cust_id,cust_line_seq_id ,cast(report_month as date)
) y group by meas_dt;

select meas_dt,sum(cnt) as meas_value,current_timestamp load_ts from (
    select count(*) cnt,extract(date from safe_CAST(mdate AS datetime)) as meas_dt,ROW_NUMBER() OVER (PARTITION BY mdate ORDER BY safe_CAST(mdate AS datetime) DESC) latest 
    from vz-it-pr-i37v-ndldo-0.vzn_ndl_vpi_core_tbls_rd_v.cpt_monthly_raw_v3 
    where CAST(mdate AS datetime)>='2025-03-01' AND CAST(mdate AS datetime)<=current_date - 1 
    group by mdate
) group by meas_dt;

select meas_dt,sum(cnt) as meas_value,current_timestamp load_ts from (
    select count(*) cnt,extract(date from safe_CAST(cptmonth AS datetime)) as meas_dt, ROW_NUMBER() OVER (PARTITION BY cptmonth ORDER BY safe_CAST(cptmonth AS datetime) DESC) latest 
    from vz-it-pr-i37v-ndldo-0.vzn_ndl_vpi_core_views_rd_v.vpi_data_n7l_view 
    where CAST(cptmonth AS datetime)>='2025-03-01' AND CAST(cptmonth AS datetime)<=current_date - 1 
    group by cptmonth
) group by meas_dt;
