      data_dt  feature_name  dimension  count_curr                      insert_date  weekday  prfl_id
0  2025-03-09  Tier1 models       <NA>         870 2025-03-09 10:36:44.246001+00:00        1     7718
2025-03-09 06:36:47 : CRM-3412694 - profile_engine - INFO : ------------------------------------------------------------------
2025-03-09 06:36:47 : CRM-3412694 - profile_engine - INFO : ------------------------------------------------------------------
2025-03-09 06:36:47 : CRM-3412694 - profile_engine - INFO : Index:: 35, Rule ID:: 7719
2025-03-09 06:36:47 : CRM-3412694 - run_bq_sql - INFO :
BQ Select Query: select cast(acss_call_dt as date)as profile_date,
'Tier1 Models' as feature_name,
null as dimension,
count (*) as value,
current_timestamp as insert_date,
extract(dayofweek from acss_call_dt) as weekday
from vz-it-pr-gk1v-cwlsdo-0.vzw_uda_prd_tbls_rd_v.acss_call where cast(acss_call_dt as date)>= current_date -2 group by 1,2,3,5,6
2025-03-09 06:36:47 : CRM-3412694 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-03-09 06:36:47 : CRM-3412694 - isTokenExpired - INFO : Token File Available
2025-03-09 06:36:47 : CRM-3412694 - isTokenExpired - INFO : Access Token is Valid
2025-03-09 06:36:47 : CRM-3412694 - bigquery_client - INFO : Setting environment variable...
2025-03-09 06:36:47 : CRM-3412694 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-03-09 06:36:52 : CRM-3412694 - profile_engine - INFO :
      data_dt  feature_name  dimension  count_curr                      insert_date  weekday  prfl_id
0  2025-03-07  Tier1 Models       <NA>      514628 2025-03-09 10:36:48.497280+00:00        6     7719
2025-03-09 06:36:52 : CRM-3412694 - profile_engine - INFO : ------------------------------------------------------------------
2025-03-09 06:36:52 : CRM-3412694 - profile_engine - INFO : ------------------------------------------------------------------
2025-03-09 06:36:52 : CRM-3412694 - profile_engine - INFO : Index:: 36, Rule ID:: 7721
2025-03-09 06:36:52 : CRM-3412694 - run_bq_sql - INFO :
BQ Select Query: select cast(current_date as date)as profile_date,
'Tier1 models' as feature_name,
null as dimension,
count (*) as value,
current_timestamp as insert_date,
extract(dayofweek from current_date) as weekday
from vz-it-pr-gk1v-cwlsdo-0.vzw_uda_prd_dmtbls_rd_v.dma_line_add group by 1,2,3,5,6
2025-03-09 06:36:52 : CRM-3412694 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-03-09 06:36:52 : CRM-3412694 - isTokenExpired - INFO : Token File Available
2025-03-09 06:36:52 : CRM-3412694 - isTokenExpired - INFO : Access Token is Valid
2025-03-09 06:36:52 : CRM-3412694 - bigquery_client - INFO : Setting environment variable...
2025-03-09 06:36:52 : CRM-3412694 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-03-09 06:36:58 : CRM-3412694 - profile_engine - INFO :
      data_dt  feature_name  dimension  count_curr                      insert_date  weekday  prfl_id
0  2025-03-09  Tier1 models       <NA>   714082507 2025-03-09 10:36:53.125682+00:00        1     7721
2025-03-09 06:36:58 : CRM-3412694 - profile_engine - INFO : ------------------------------------------------------------------
2025-03-09 06:36:58 : CRM-3412694 - profile_engine - INFO : Length of the Rules Result : 191
2025-03-09 06:36:58 : CRM-3412694 - profile_engine - INFO :
Index(['data_dt', 'feature_name', 'dimension', 'count_curr', 'insert_date',
       'weekday', 'prfl_id', 'rule_run_ts'],
      dtype='object')
      data_dt  feature_name dimension  count_curr                      insert_date  weekday  prfl_id rule_run_ts
0  2025-03-08  Tier1 Models      <NA>       24048 2025-03-09 10:33:38.432053+00:00        7     7662         NaT
1  2025-03-08  Tier1 Models      <NA>      504964 2025-03-09 10:33:42.514760+00:00        7     7663         NaT
2  2025-03-07  Tier1 Models      <NA>      660005 2025-03-09 10:33:42.514760+00:00        6     7663         NaT
3  2445-03-08  Tier1 Models      <NA>           2 2025-03-09 10:33:42.514760+00:00        4     7663         NaT
4  3116-03-01  Tier1 Models      <NA>           1 2025-03-09 10:33:42.514760+00:00        4     7663         NaT
2025-03-09 06:36:58 : CRM-3412694 - run_bq_sql - INFO :
BQ Select Query:
            with top_records as
            (
            select *,row_number() over (partition by prfl_id,feature_name,grouped_columns order by data_dt desc) as row_num
            from vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt join
            unnest(GENERATE_DATE_ARRAY(date_sub(current_date-1,INTERVAL 3 MONTH),current_date-1, INTERVAL 1 day)) as interval_Date
            on data_dt = interval_Date
            where prfl_id IN (7681, 7685, 7686, 7687, 7690, 7695, 7696, 7697, 7699, 7700, 7701, 7702, 7703, 7705, 7708, 7710, 7711, 7712, 7713, 7715, 7716, 7718, 7719, 7721, 7662, 7663, 7664, 7666, 7667, 7668, 7669, 7670, 7671, 7672, 7674, 7676, 7678)
            and data_dt != current_date-1
            order by prfl_id,feature_name, grouped_columns,data_dt desc
            )
            select prfl_id,feature_name,grouped_columns,WEEKDAY,
            round(sum(ifnull(count_curr, 0)), 2) as sum_count_prev,
            round(avg(ifnull(count_curr, 0)), 2) as avg_count_prev,
            round(var_pop(ifnull(count_curr, 0)), 2) as variance_value,
            round(stddev_pop(ifnull(count_curr, 0)), 2) as std_dev_value,
            round(stddev_pop(ifnull(count_curr, 0)) * 2.0, 2) as sigma_2_value,
            round(avg(ifnull(count_curr, 0)) - stddev_pop(ifnull(count_curr, 0)) * 2.0, 2) as min_thresh_value,
            round(avg(ifnull(count_curr, 0)) + stddev_pop(ifnull(count_curr, 0)) * 2.0, 2) as max_thresh_value
            from top_records
            group by prfl_id,feature_name,grouped_columns,WEEKDAY
            order by prfl_id,feature_name,grouped_columns,WEEKDAY;

2025-03-09 06:36:58 : CRM-3412694 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-03-09 06:36:58 : CRM-3412694 - isTokenExpired - INFO : Token File Available
2025-03-09 06:36:58 : CRM-3412694 - isTokenExpired - INFO : Access Token is Valid
2025-03-09 06:36:58 : CRM-3412694 - bigquery_client - INFO : Setting environment variable...
2025-03-09 06:36:58 : CRM-3412694 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-03-09 06:37:01 : CRM-3412694 - get_historical_details - INFO : Length of the historical groupby list : 76
2025-03-09 06:37:01 : CRM-3412694 - get_historical_details - INFO :
Index(['prfl_id', 'feature_name', 'grouped_columns', 'weekday',
       'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value',
       'sigma_2_value', 'min_thresh_value', 'max_thresh_value'],
      dtype='object')
   prfl_id  feature_name grouped_columns  weekday  ... std_dev_value sigma_2_value  min_thresh_value  max_thresh_value
0     7662  Tier1 Models            null        5  ...           0.0           0.0           24045.0           24045.0
1     7663  Tier1 Models            null        4  ...           0.0           0.0          494197.0          494197.0
2     7663  Tier1 Models            null        5  ...           0.0           0.0          300864.0          300864.0
3     7664  Tier1 Models            null        4  ...           0.0           0.0           25556.0           25556.0
4     7666  Tier1 Models            null        4  ...           0.0           0.0           27627.0           27627.0

[5 rows x 11 columns]
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : ------------------------------------------------------------------
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Historical DataFrame Columns: ['prfl_id', 'feature_name', 'grouped_columns', 'weekday', 'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value', 'sigma_2_value', 'min_thresh_value', 'max_thresh_value']
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Latest DataFrame Columns: ['data_dt', 'feature_name', 'grouped_columns', 'count_curr', 'insert_date', 'weekday', 'prfl_id', 'prfl_run_ts']
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Historical DataFrame Data Types:
prfl_id               Int64
feature_name         object
grouped_columns      object
weekday               Int64
sum_count_prev       object
avg_count_prev       object
variance_value      float64
std_dev_value       float64
sigma_2_value       float64
min_thresh_value    float64
max_thresh_value    float64
dtype: object
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Latest DataFrame Data Types:
data_dt                         object
feature_name                    object
grouped_columns                 object
count_curr                       int64
insert_date        datetime64[ns, UTC]
weekday                          int64
prfl_id                          int64
prfl_run_ts                     object
dtype: object
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Historical DataFrame Sample:
   prfl_id  feature_name grouped_columns  weekday  ... std_dev_value sigma_2_value  min_thresh_value  max_thresh_value
0     7662  Tier1 Models            null        5  ...           0.0           0.0           24045.0           24045.0
1     7663  Tier1 Models            null        4  ...           0.0           0.0          494197.0          494197.0
2     7663  Tier1 Models            null        5  ...           0.0           0.0          300864.0          300864.0

[3 rows x 11 columns]
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Latest DataFrame Sample:
      data_dt  feature_name grouped_columns  count_curr                      insert_date  weekday  prfl_id          prfl_run_ts
0  2025-03-08  Tier1 Models            <NA>       24048 2025-03-09 10:33:38.432053+00:00        7     7662  2025-03-09 06:36:58
1  2025-03-08  Tier1 Models            <NA>      504964 2025-03-09 10:33:42.514760+00:00        7     7663  2025-03-09 06:36:58
2  2025-03-07  Tier1 Models            <NA>      660005 2025-03-09 10:33:42.514760+00:00        6     7663  2025-03-09 06:36:58
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Length of the historical Records : 76
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO :
Index(['prfl_id', 'feature_name', 'grouped_columns', 'weekday',
       'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value',
       'sigma_2_value', 'min_thresh_value', 'max_thresh_value'],
      dtype='object')
   prfl_id  feature_name grouped_columns  weekday  sum_count_prev  ...  variance_value  std_dev_value  sigma_2_value  min_thresh_value  max_thresh_value
0     7662  Tier1 Models            null        5         24045.0  ...             0.0            0.0            0.0           24045.0           24045.0
1     7663  Tier1 Models            null        4        494197.0  ...             0.0            0.0            0.0          494197.0          494197.0
2     7663  Tier1 Models            null        5        300864.0  ...             0.0            0.0            0.0          300864.0          300864.0
3     7664  Tier1 Models            null        4         25556.0  ...             0.0            0.0            0.0           25556.0           25556.0
4     7666  Tier1 Models            null        4         27627.0  ...             0.0            0.0            0.0           27627.0           27627.0

[5 rows x 11 columns]
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : ------------------------------------------------------------------
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Length of the latest Records : 191
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO :
Index(['data_dt', 'feature_name', 'grouped_columns', 'count_curr',
       'insert_date', 'weekday', 'prfl_id', 'prfl_run_ts'],
      dtype='object')
     data_dt  feature_name grouped_columns  count_curr                      insert_date  weekday  prfl_id         prfl_run_ts
0 2025-03-08  Tier1 Models                       24048 2025-03-09 10:33:38.432053+00:00        7     7662 2025-03-09 06:36:58
1 2025-03-08  Tier1 Models                      504964 2025-03-09 10:33:42.514760+00:00        7     7663 2025-03-09 06:36:58
2 2025-03-07  Tier1 Models                      660005 2025-03-09 10:33:42.514760+00:00        6     7663 2025-03-09 06:36:58
3        NaT  Tier1 Models                           2 2025-03-09 10:33:42.514760+00:00        4     7663 2025-03-09 06:36:58
4        NaT  Tier1 Models                           1 2025-03-09 10:33:42.514760+00:00        4     7663 2025-03-09 06:36:58
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Fixed Historical DataFrame Data Types:
prfl_id               Int64
feature_name         object
grouped_columns      object
weekday               Int64
sum_count_prev      float64
avg_count_prev      float64
variance_value      float64
std_dev_value       float64
sigma_2_value       float64
min_thresh_value    float64
max_thresh_value    float64
dtype: object
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Fixed Latest DataFrame Data Types:
data_dt                 datetime64[ns]
feature_name                    object
grouped_columns                 object
count_curr                       int64
insert_date        datetime64[ns, UTC]
weekday                          int64
prfl_id                          int64
prfl_run_ts             datetime64[ns]
dtype: object
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : ------------------------------------------------------------------
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Historical Dataframe ::     prfl_id  feature_name grouped_columns  weekday  sum_count_prev  ...  variance_value  std_dev_value  sigma_2_value  min_thresh_value  max_thresh_value
0      7662  Tier1 Models            null        5         24045.0  ...             0.0            0.0            0.0           24045.0           24045.0
1      7663  Tier1 Models            null        4        494197.0  ...             0.0            0.0            0.0          494197.0          494197.0
2      7663  Tier1 Models            null        5        300864.0  ...             0.0            0.0            0.0          300864.0          300864.0
3      7664  Tier1 Models            null        4         25556.0  ...             0.0            0.0            0.0           25556.0           25556.0
4      7666  Tier1 Models            null        4         27627.0  ...             0.0            0.0            0.0           27627.0           27627.0
..      ...           ...             ...      ...             ...  ...             ...            ...            ...               ...               ...
71     7716  Tier1 Models            null        4        214813.0  ...             0.0            0.0            0.0          214813.0          214813.0
72     7716  Tier1 Models            null        5       3162096.0  ...             0.0            0.0            0.0         3162096.0         3162096.0
73     7718  Tier1 models            null        6           870.0  ...             0.0            0.0            0.0             870.0             870.0
74     7719  Tier1 Models            null        4        537923.0  ...             0.0            0.0            0.0          537923.0          537923.0
75     7721  Tier1 models            null        6     714082827.0  ...             0.0            0.0            0.0       714082827.0       714082827.0

[76 rows x 11 columns]
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Latest Dataframe ::        data_dt  feature_name grouped_columns  count_curr                      insert_date  weekday  prfl_id         prfl_run_ts
0   2025-03-08  Tier1 Models                       24048 2025-03-09 10:33:38.432053+00:00        7     7662 2025-03-09 06:36:58
1   2025-03-08  Tier1 Models                      504964 2025-03-09 10:33:42.514760+00:00        7     7663 2025-03-09 06:36:58
2   2025-03-07  Tier1 Models                      660005 2025-03-09 10:33:42.514760+00:00        6     7663 2025-03-09 06:36:58
3          NaT  Tier1 Models                           2 2025-03-09 10:33:42.514760+00:00        4     7663 2025-03-09 06:36:58
4          NaT  Tier1 Models                           1 2025-03-09 10:33:42.514760+00:00        4     7663 2025-03-09 06:36:58
..         ...           ...             ...         ...                              ...      ...      ...                 ...
186 2025-03-07  Tier1 Models                      311401 2025-03-09 10:36:39.235962+00:00        6     7716 2025-03-09 06:36:58
187 2025-03-08  Tier1 Models                     2993904 2025-03-09 10:36:39.235962+00:00        7     7716 2025-03-09 06:36:58
188 2025-03-09  Tier1 models                         870 2025-03-09 10:36:44.246001+00:00        1     7718 2025-03-09 06:36:58
189 2025-03-07  Tier1 Models                      514628 2025-03-09 10:36:48.497280+00:00        6     7719 2025-03-09 06:36:58
190 2025-03-09  Tier1 models                   714082507 2025-03-09 10:36:53.125682+00:00        1     7721 2025-03-09 06:36:58

[191 rows x 8 columns]
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : Length of the Merged Records : 191
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO :
Index(['prfl_id', 'feature_name', 'grouped_columns', 'weekday',
       'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value',
       'sigma_2_value', 'min_thresh_value', 'max_thresh_value', 'data_dt',
       'count_curr', 'insert_date', 'prfl_run_ts'],
      dtype='object')
   prfl_id  feature_name grouped_columns  weekday  ...    data_dt  count_curr                      insert_date         prfl_run_ts
0     7662  Tier1 Models                        7  ... 2025-03-08       24048 2025-03-09 10:33:38.432053+00:00 2025-03-09 06:36:58
1     7663  Tier1 Models                        7  ... 2025-03-08      504964 2025-03-09 10:33:42.514760+00:00 2025-03-09 06:36:58
2     7663  Tier1 Models                        6  ... 2025-03-07      660005 2025-03-09 10:33:42.514760+00:00 2025-03-09 06:36:58
3     7663  Tier1 Models                        4  ...        NaT           2 2025-03-09 10:33:42.514760+00:00 2025-03-09 06:36:58
4     7663  Tier1 Models                        4  ...        NaT           1 2025-03-09 10:33:42.514760+00:00 2025-03-09 06:36:58

[5 rows x 15 columns]
2025-03-09 06:37:01 : CRM-3412694 - compare_historical_latest_dimensions - INFO : ------------------------------------------------------------------
calculate_percentage_change
calculate_sigma_value
calculate_dq_status
2025-03-09 06:37:01 : CRM-3412694 - run_metrics_engine - INFO : ------------------------------------------------------------------
2025-03-09 06:37:01 : CRM-3412694 - run_metrics_engine - INFO : Length of the End Results : 191
2025-03-09 06:37:01 : CRM-3412694 - run_metrics_engine - INFO :
Index(['prfl_id', 'feature_name', 'grouped_columns', 'weekday',
       'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value',
       'sigma_2_value', 'min_thresh_value', 'max_thresh_value', 'data_dt',
       'count_curr', 'insert_date', 'prfl_run_ts', 'prfl_type', 'src_tbl',
       'dq_pillar', 'meas_name', 'min_threshold', 'max_threshold',
       'comparison_type', 'is_hourly_flg', 'pct_change', 'consistency_score',
       'dq_score', 'sigma_value', 'dq_ind'],
      dtype='object')
   prfl_id  feature_name grouped_columns  weekday  sum_count_prev  avg_count_prev  ...  is_hourly_flg  pct_change  consistency_score  dq_score  sigma_value dq_ind
0     7662  Tier1 Models                        7             NaN             NaN  ...              N         NaN                0.0         0      outlier    LOW
1     7663  Tier1 Models                        7             NaN             NaN  ...              N         NaN                0.0         0      outlier    LOW
2     7663  Tier1 Models                        6             NaN             NaN  ...              N         NaN                0.0         0      outlier    LOW
3     7663  Tier1 Models                        4             NaN             NaN  ...              N         NaN                0.0         0      outlier    LOW
4     7663  Tier1 Models                        4             NaN             NaN  ...              N         NaN                0.0         0      outlier    LOW

[5 rows x 28 columns]
2025-03-09 06:37:01 : CRM-3412694 - run_metrics_engine - INFO : ------------------------------------------------------------------
2025-03-09 06:37:01 : CRM-3412694 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-03-09 06:37:01 : CRM-3412694 - isTokenExpired - INFO : Token File Available
2025-03-09 06:37:01 : CRM-3412694 - isTokenExpired - INFO : Access Token is Valid
2025-03-09 06:37:01 : CRM-3412694 - bigquery_client - INFO : Setting environment variable...
2025-03-09 06:37:01 : CRM-3412694 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - WARNING : Column 'consistecy_score' missing, adding it with default value 0.
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - INFO : --------Data Types After Fixing:
prfl_id                            Int64
feature_name                      object
grouped_columns                   object
weekday                            Int64
sum_count_prev                   float64
avg_count_prev                   float64
variance_value                   float64
std_dev_value                    float64
sigma_2_value                    float64
min_thresh_value                 float64
max_thresh_value                 float64
data_dt                   datetime64[ns]
count_curr                       float64
insert_date          datetime64[ns, UTC]
prfl_run_ts               datetime64[ns]
prfl_type                         object
src_tbl                           object
dq_pillar                         object
meas_name                         object
min_threshold                    float64
max_threshold                    float64
comparison_type                   object
is_hourly_flg                     object
pct_change                       float64
consistency_score                float64
dq_score                           int64
sigma_value                       object
dq_ind                            object
rpt_ref_key                       object
consistecy_score                 float64
dtype: object
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - WARNING : Some numeric values couldn't be converted. Check for missing data.
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - INFO : Data Types Fixed Before BigQuery Load:
prfl_id                            Int64
feature_name                      object
grouped_columns                   object
weekday                            Int64
sum_count_prev                   float64
avg_count_prev                   float64
variance_value                   float64
std_dev_value                    float64
sigma_2_value                    float64
min_thresh_value                 float64
max_thresh_value                 float64
data_dt                   datetime64[ns]
count_curr                       float64
insert_date          datetime64[ns, UTC]
prfl_run_ts               datetime64[ns]
prfl_type                         object
src_tbl                           object
dq_pillar                         object
meas_name                         object
min_threshold                    float64
max_threshold                    float64
comparison_type                   object
is_hourly_flg                     object
pct_change                       float64
consistency_score                float64
dq_score                           int64
sigma_value                       object
dq_ind                            object
rpt_ref_key                       object
consistecy_score                 float64
dtype: object
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - INFO : Data Types Fixed After BigQuery Load:
prfl_id                            Int64
feature_name                      object
grouped_columns                   object
weekday                            Int64
sum_count_prev                   float64
avg_count_prev                   float64
variance_value                   float64
std_dev_value                    float64
sigma_2_value                    float64
min_thresh_value                 float64
max_thresh_value                 float64
data_dt                   datetime64[ns]
count_curr                       float64
insert_date          datetime64[ns, UTC]
prfl_run_ts               datetime64[ns]
prfl_type                         object
src_tbl                           object
dq_pillar                         object
meas_name                         object
min_threshold                    float64
max_threshold                    float64
comparison_type                   object
is_hourly_flg                     object
pct_change                       float64
consistency_score                float64
dq_score                           int64
sigma_value                       object
dq_ind                            object
rpt_ref_key                       object
consistecy_score                 float64
dtype: object
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - INFO : DataFrame before BigQuery Load:
   prfl_id  feature_name grouped_columns  weekday  sum_count_prev  ...  dq_score  sigma_value  dq_ind           rpt_ref_key  consistecy_score
0     7662  Tier1 Models                        7             NaN  ...         0      outlier     LOW  20250307132142792994               0.0
1     7663  Tier1 Models                        7             NaN  ...         0      outlier     LOW  20250307132142792994               0.0
2     7663  Tier1 Models                        6             NaN  ...         0      outlier     LOW  20250307132142792994               0.0
3     7663  Tier1 Models                        4             NaN  ...         0      outlier     LOW  20250307132142792994               0.0
4     7663  Tier1 Models                        4             NaN  ...         0      outlier     LOW  20250307132142792994               0.0

[5 rows x 30 columns]
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - WARNING : Warning: Some numeric values contain NaNs! Count: 954
2025-03-09 06:37:01 : CRM-3412694 - load_to_report_results - INFO : Columns before BigQuery Load: ['prfl_id', 'feature_name', 'grouped_columns', 'weekday', 'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value', 'sigma_2_value', 'min_thresh_value', 'max_thresh_value', 'data_dt', 'count_curr', 'insert_date', 'prfl_run_ts', 'prfl_type', 'src_tbl', 'dq_pillar', 'meas_name', 'min_threshold', 'max_threshold', 'comparison_type', 'is_hourly_flg', 'pct_change', 'consistency_score', 'dq_score', 'sigma_value', 'dq_ind', 'rpt_ref_key', 'consistecy_score']
2025-03-09 06:37:01 : CRM-3412694 - load_result_to_bq_report_table - INFO :
            ======================================================================================
            Load Result Started for Table : vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt
            Sequence Column: rpt_seq_num
            Records Length: 191
            Report Columns: Index(['prfl_id', 'feature_name', 'grouped_columns', 'weekday',
       'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value',
       'sigma_2_value', 'min_thresh_value', 'max_thresh_value', 'data_dt',
       'count_curr', 'insert_date', 'prfl_run_ts', 'prfl_type', 'src_tbl',
       'dq_pillar', 'meas_name', 'min_threshold', 'max_threshold',
       'comparison_type', 'is_hourly_flg', 'pct_change', 'consistency_score',
       'dq_score', 'sigma_value', 'dq_ind', 'rpt_ref_key', 'consistecy_score'],
      dtype='object')
            ======================================================================================

2025-03-09 06:37:01 : CRM-3412694 - get_bq_max_sequence - INFO : sq_column: rpt_seq_num
 bq_tablename : vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt
2025-03-09 06:37:01 : CRM-3412694 - get_bq_max_sequence - INFO : BQ query: select IFNULL(MAX(rpt_seq_num), 0) from vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt
2025-03-09 06:37:06 : CRM-3412694 - get_bq_max_sequence - INFO : count:        f0_
0  8927101
2025-03-09 06:37:06 : CRM-3412694 - get_bq_max_sequence - INFO : Max Sequence: 8927101
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO :
            Dataframe Columns:['prfl_id', 'feature_name', 'grouped_columns', 'weekday', 'sum_count_prev', 'avg_count_prev', 'variance_value', 'std_dev_value', 'sigma_2_value', 'min_thresh_value', 'max_thresh_value', 'data_dt', 'count_curr', 'insert_date', 'prfl_run_ts', 'prfl_type', 'src_tbl', 'dq_pillar', 'meas_name', 'min_threshold', 'max_threshold', 'comparison_type', 'is_hourly_flg', 'pct_change', 'consistency_score', 'dq_score', 'sigma_value', 'dq_ind', 'rpt_ref_key', 'consistecy_score', 'rpt_seq_num']
            Requried Columns: ['avg_count_prev', 'variance_value', 'std_dev_value', 'pct_change', 'count_curr', 'sigma_2_value', 'dq_score', 'consistency_score', 'prfl_id', 'weekday', 'rpt_seq_num', 'feature_name', 'grouped_columns', 'sigma_value', 'rpt_ref_key', 'data_dt', 'prfl_type', 'src_tbl', 'dq_pillar', 'meas_name', 'dq_ind', 'prfl_run_ts']

2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : Columns for : ['avg_count_prev', 'variance_value', 'std_dev_value', 'pct_change', 'count_curr', 'sigma_2_value', 'dq_score', 'consistency_score', 'prfl_id', 'weekday', 'rpt_seq_num', 'feature_name', 'grouped_columns', 'sigma_value', 'rpt_ref_key', 'data_dt', 'prfl_type', 'src_tbl', 'dq_pillar', 'meas_name', 'dq_ind', 'prfl_run_ts']
<class 'pandas.core.frame.DataFrame'>
Int64Index: 191 entries, 0 to 190
Data columns (total 22 columns):
 #   Column             Non-Null Count  Dtype
---  ------             --------------  -----
 0   prfl_id            191 non-null    Int64
 1   feature_name       191 non-null    object
 2   grouped_columns    191 non-null    object
 3   weekday            191 non-null    Int64
 4   avg_count_prev     0 non-null      float64
 5   variance_value     0 non-null      float64
 6   std_dev_value      0 non-null      float64
 7   sigma_2_value      0 non-null      float64
 8   data_dt            186 non-null    datetime64[ns]
 9   count_curr         191 non-null    float64
 10  prfl_run_ts        191 non-null    datetime64[ns]
 11  prfl_type          191 non-null    object
 12  src_tbl            191 non-null    object
 13  dq_pillar          191 non-null    object
 14  meas_name          191 non-null    object
 15  pct_change         1 non-null      float64
 16  consistency_score  191 non-null    float64
 17  dq_score           191 non-null    int64
 18  sigma_value        191 non-null    object
 19  dq_ind             191 non-null    object
 20  rpt_ref_key        191 non-null    object
 21  rpt_seq_num        191 non-null    int64
dtypes: Int64(2), datetime64[ns](2), float64(7), int64(2), object(9)
memory usage: 34.7+ KB
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : None
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : String.................
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : Numeric................
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : Integer................
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : Datetime...............
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : TIMESTAMP...............
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : Completed..............
<class 'pandas.core.frame.DataFrame'>
Int64Index: 191 entries, 0 to 190
Data columns (total 22 columns):
 #   Column             Non-Null Count  Dtype
---  ------             --------------  -----
 0   prfl_id            191 non-null    Int64
 1   feature_name       191 non-null    object
 2   grouped_columns    191 non-null    object
 3   weekday            191 non-null    Int64
 4   avg_count_prev     0 non-null      object
 5   variance_value     0 non-null      object
 6   std_dev_value      0 non-null      object
 7   sigma_2_value      0 non-null      object
 8   data_dt            191 non-null    object
 9   count_curr         191 non-null    object
 10  prfl_run_ts        191 non-null    datetime64[ns]
 11  prfl_type          191 non-null    object
 12  src_tbl            191 non-null    object
 13  dq_pillar          191 non-null    object
 14  meas_name          191 non-null    object
 15  pct_change         1 non-null      object
 16  consistency_score  191 non-null    object
 17  dq_score           191 non-null    object
 18  sigma_value        191 non-null    object
 19  dq_ind             191 non-null    object
 20  rpt_ref_key        191 non-null    object
 21  rpt_seq_num        191 non-null    int64
dtypes: Int64(2), datetime64[ns](1), int64(1), object(18)
memory usage: 34.7+ KB
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : None
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - ERROR : Error Occurred while loading Results to BigQuery Table. Error: object of type <class 'str'> cannot be converted to int
2025-03-09 06:37:06 : CRM-3412694 - load_result_to_bq_report_table - INFO : Load Result Error vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt table
2025-03-09 06:37:06 : CRM-3412694 - send_email_report - INFO : Mail Query :
                select rpt.*,
                mtd.data_lob, mtd.db_name ,mtd.src_tbl ,mtd.dq_pillar
                from vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_mtd mtd
                inner join
                (select * from vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt
                where rpt_ref_key = '20250309063333959977' ) rpt
                on mtd.prfl_id = rpt.prfl_id
                and upper(mtd.prfl_type) = 'CUSTOM_RULES'

2025-03-09 06:37:06 : CRM-3412694 - run_bq_sql - INFO :
BQ Select Query:
                select rpt.*,
                mtd.data_lob, mtd.db_name ,mtd.src_tbl ,mtd.dq_pillar
                from vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_mtd mtd
                inner join
                (select * from vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt
                where rpt_ref_key = '20250309063333959977' ) rpt
                on mtd.prfl_id = rpt.prfl_id
                and upper(mtd.prfl_type) = 'CUSTOM_RULES'

2025-03-09 06:37:06 : CRM-3412694 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-03-09 06:37:06 : CRM-3412694 - isTokenExpired - INFO : Token File Available
2025-03-09 06:37:06 : CRM-3412694 - isTokenExpired - INFO : Access Token is Valid
2025-03-09 06:37:06 : CRM-3412694 - bigquery_client - INFO : Setting environment variable...
2025-03-09 06:37:06 : CRM-3412694 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-03-09 06:37:10 : CRM-3412694 - send_email_report - ERROR : Error in Report Summary Email Block. Error:No Records found for Email Summary
2025-03-09 06:37:10 : CRM-3412694 - send_opsgenie_jira_outlier_alert - INFO : Opsgenie Info Query:
                SELECT rpt.*,
                    mtd.data_lob, mtd.data_dmn,mtd.data_sub_dmn, mtd.db_name, mtd.src_tbl,mtd.meas_name,
                    mtd.data_src, mtd.dq_pillar, mtd.opsgenie_api_key, mtd.is_opsgenie_flg,mtd.jira_assignee
                FROM vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_mtd mtd
                INNER JOIN
                (SELECT * FROM vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt
                WHERE rpt_ref_key = '20250309063333959977') rpt
                ON mtd.prfl_id = rpt.prfl_id
                WHERE upper(mtd.prfl_type) = 'CUSTOM_RULES'

2025-03-09 06:37:10 : CRM-3412694 - run_bq_sql - INFO :
BQ Select Query:
                SELECT rpt.*,
                    mtd.data_lob, mtd.data_dmn,mtd.data_sub_dmn, mtd.db_name, mtd.src_tbl,mtd.meas_name,
                    mtd.data_src, mtd.dq_pillar, mtd.opsgenie_api_key, mtd.is_opsgenie_flg,mtd.jira_assignee
                FROM vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_mtd mtd
                INNER JOIN
                (SELECT * FROM vz-it-np-izcv-dev-idmcdo-0.dga_dq_tbls.dqaas_profile_rpt
                WHERE rpt_ref_key = '20250309063333959977') rpt
                ON mtd.prfl_id = rpt.prfl_id
                WHERE upper(mtd.prfl_type) = 'CUSTOM_RULES'

2025-03-09 06:37:10 : CRM-3412694 - isTokenExpired - INFO : Token file Path is /apps/opt/application/smartdq//smartdq_gcp_migration//config/dqaas1_oidc_token.json
2025-03-09 06:37:10 : CRM-3412694 - isTokenExpired - INFO : Token File Available
2025-03-09 06:37:10 : CRM-3412694 - isTokenExpired - INFO : Access Token is Valid
2025-03-09 06:37:10 : CRM-3412694 - bigquery_client - INFO : Setting environment variable...
2025-03-09 06:37:10 : CRM-3412694 - bigquery_client - INFO : Connected to vz-it-np-izcv-dev-idmcdo-0 project space
2025-03-09 06:37:13 : CRM-3412694 - send_opsgenie_jira_outlier_alert - WARNING : No records found for Opsgenie alert
(smartdq-venv) tdcldizcva002:/apps/opt/application/smartdq/smartdq_gcp_migration/customer_metrics_and_micro_segment$
